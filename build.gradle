apply plugin: 'konan'

konanArtifacts {
    interop('libui') {
        defFile 'src/main/libui.def'
        includeDirs "${project.rootDir}/libui"
    }

    program('test') {
        srcFiles fileTree('src/test/kotlin')
        libraries {
            artifact 'libui'
        }
        target 'mingw', {
            dependsOn 'windres'
            linkerOpts "build/samples.res"
        }
    }

    program('hello1') {
        srcFiles 'samples/hello/hello.kt'
        libraries {
            artifact 'libui'
        }
        target 'mingw', {
            dependsOn 'windres'
            linkerOpts "build/samples.res"
        }
    }

    program('hello2') {
        srcFiles 'samples/hello/hello2.kt'
        srcFiles fileTree('src/main/kotlin')
        libraries {
            artifact 'libui'
        }
        target 'mingw', {
            dependsOn 'windres'
            linkerOpts "build/samples.res"
        }
    }
}

task windres(type: Exec) {
    commandLine "windres", file("samples/samples.rc"), '-O', 'coff', '-o', file("build/samples.res")
}

buildscript {
    repositories {
        mavenCentral()
        maven { url "https://dl.bintray.com/jetbrains/kotlin-native-dependencies" }
    }
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-native-gradle-plugin:0.7"
    }
}
